@model ProjectPizzaWeb.Models.ReviewOrderViewModel
@inject ProjectPizzaWeb.Services.CartItemService cartItemService

@{
    ViewData["Title"] = "Review Order";
}

<h2>Review Order</h2>

<div class="container">
    <div class="row">
        <div class="col-sm-6">

            <ul class="list-group">
                <li class="list-group-item list-group-item-warning list-group-item-heading">
                    <span class="glyphicon glyphicon-shopping-cart"></span> Cart
                </li>

                @if (Model.Cart.CartItems.Count == 0)
                {
                    <li class="list-group-item">

                        <p>Empty cart</p>

                    </li>
                }
                else
                {
                    <li class="list-group-item">
                        
                        <h4>Your cart</h4>
                        <hr />
                        @{ 
                            var checkoutPrice = 0;
                        }

                        @foreach (var item in Model.Cart.CartItems)
                        {

                            var ingredients = cartItemService.GetIngredients(item.CartItemId);
                            var extraCount = cartItemService.SumExtraIngredientsForOne(item);
                            var extraValue = cartItemService.SumExtraIngredientsValue(item);
                            checkoutPrice += (extraValue + item.Dish.Price) * item.Quantity;

                            <div class="row">
                                <div class="col-sm-1">
                                    <strong><text>x</text>@item.Quantity</strong>
                                </div>
                                <div class="col-sm-7">
                                    <span>@item.Dish.Name </span>
                                </div>
                                <div class="col-sm-4">
                                    <span class="pull-right">@item.Dish.Price kr</span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-1">
                                   
                                </div>
                                <div class="col-sm-7">
                                    <i>
                                        @foreach (var ingredient in ingredients)
                                        {
                                            @ingredient.Ingredient.Name@if (ingredients.Last() != ingredient)
                                            {
                                                <text>, </text>
                                            }

                                        }
                                        @if (extraCount > 0)
                                        {
                                            <text>(+</text>@extraCount<text> extra@(extraCount > 1? "s": null))</text>
                                        }
                                    </i>

                                </div>
                                <div class="col-sm-4">
                                    <i class="pull-right">
                                        @if (extraCount > 0) {
                                            <text>+ </text>@(extraValue)<text> kr</text>
                                        }
                                    </i>
                                </div>
                            </div>
                            <hr />
                        }
                    </li>


                    <li class="list-group-item">
                        <div class="row">
                            <div class="col-sm-12">
                                Total:
                                <strong class="pull-right lead">
                                @checkoutPrice kr
                                </strong>
                            </div>
                        </div>
                    </li>
                }
            </ul>

        </div>

        <div class="col-sm-6">
            <form>
            <ul class="list-group">
                <li class="list-group-item list-group-item-warning list-group-item-heading">
                    Address
                </li>

                <li class="list-group-item">


                        <h4>Address</h4>

                        <div class="form-group">
                            <label asp-for="Cart.ApplicationUser.Email"></label>
                            <input asp-for="Cart.ApplicationUser.Email" class="form-control" />
                            <span asp-validation-for="Cart.ApplicationUser.Email" class="text-danger"></span>
                        </div>
                        <div class="form-group">
                            <label asp-for="Cart.ApplicationUser.PostalAddress"></label>
                            <input asp-for="Cart.ApplicationUser.PostalAddress" class="form-control" />
                            <span asp-validation-for="Cart.ApplicationUser.PostalAddress" class="text-danger"></span>
                        </div>
                        <div class="form-group">
                            <label asp-for="Cart.ApplicationUser.PostalCode"></label>
                            <input asp-for="Cart.ApplicationUser.PostalCode" class="form-control" />
                            <span asp-validation-for="Cart.ApplicationUser.PostalCode" class="text-danger"></span>
                        </div>
                        <div class="form-group">
                            <label asp-for="Cart.ApplicationUser.City"></label>
                            <input asp-for="Cart.ApplicationUser.City" class="form-control" />
                            <span asp-validation-for="Cart.ApplicationUser.City" class="text-danger"></span>
                        </div>
                        <div class="form-group">
                            <label asp-for="Cart.ApplicationUser.Phone"></label>
                            <input asp-for="Cart.ApplicationUser.Phone" class="form-control" />
                            <span asp-validation-for="Cart.ApplicationUser.Phone" class="text-danger"></span>
                        </div>
                </li>
            </ul>

                <hr />

                <a href="#" class="btn btn-default btn-md">
                    <span class="glyphicon glyphicon-check"></span> Purchase now
                </a>

            </form>
        </div>
    </div>
</div>

}